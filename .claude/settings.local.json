{
  "permissions": {
    "allow": [
      "Bash(dotnet build:*)",
      "Bash(git restore:*)",
      "Bash(cat:*)",
      "Bash(dir:*)",
      "Bash(curl:*)",
      "Bash(tree:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(git branch:*)",
      "Bash(find:*)",
      "Bash(powershell -Command:*)",
      "Bash(python migrate_client.py:*)",
      "Bash(/c/Users/kaleb/AppData/Local/Microsoft/WindowsApps/python3 migrate_client.py)",
      "Bash(chmod:*)",
      "Bash(bash:*)",
      "Bash(dotnet restore:*)",
      "Bash(dotnet new:*)",
      "Bash(dotnet sln:*)",
      "Bash(wc:*)",
      "Bash(\"c:/Users/kaleb/OneDrive/Desktop/Projects/DatasetEditor/src/Extensions/BuiltIn/Creator/extension.manifest.json\" <<'MANIFEST'\n{\n  \"schemaVersion\": 1,\n  \"metadata\": {\n    \"id\": \"Creator\",\n    \"name\": \"Dataset Creator\",\n    \"version\": \"1.0.0\",\n    \"description\": \"Create and import datasets from various sources\"\n  },\n  \"deploymentTarget\": \"Both\"\n}\nMANIFEST)",
      "Bash(\"c:/Users/kaleb/OneDrive/Desktop/Projects/DatasetEditor/src/Extensions/BuiltIn/Editor/extension.manifest.json\" <<'MANIFEST'\n{\n  \"schemaVersion\": 1,\n  \"metadata\": {\n    \"id\": \"Editor\",\n    \"name\": \"Dataset Editor\",\n    \"version\": \"1.0.0\",\n    \"description\": \"Edit dataset items and metadata\"\n  },\n  \"deploymentTarget\": \"Both\"\n}\nMANIFEST)",
      "Bash(\"c:/Users/kaleb/OneDrive/Desktop/Projects/DatasetEditor/src/Extensions/BuiltIn/AITools/extension.manifest.json\" <<'MANIFEST'\n{\n  \"schemaVersion\": 1,\n  \"metadata\": {\n    \"id\": \"AITools\",\n    \"name\": \"AI Tools Integration\",\n    \"version\": \"1.0.0\",\n    \"description\": \"AI-powered dataset tools\"\n  },\n  \"deploymentTarget\": \"Both\"\n}\nMANIFEST)",
      "Bash(\"c:/Users/kaleb/OneDrive/Desktop/Projects/DatasetEditor/src/Extensions/SDK/APPSETTINGS_EXAMPLES.md\" <<'EOF'\n# Extension System Configuration\n\nThis document shows how to configure the extension system in appsettings.json for both API and Client projects.\n\n## API Backend Configuration (src/APIBackend/appsettings.json)\n\nAdd this to your appsettings.json:\n\n```json\n{\n  \"Extensions\": {\n    \"Enabled\": true,\n    \"AutoLoad\": true,\n    \"Directory\": \"./Extensions/BuiltIn\",\n    \"UserDirectory\": \"./Extensions/User\",\n    \"LoadTimeout\": 30000\n  },\n  \n  \"Extensions:CoreViewer\": {\n    \"DefaultPageSize\": 50,\n    \"EnableVirtualization\": true,\n    \"CacheTimeout\": 300\n  },\n  \n  \"Extensions:Creator\": {\n    \"MaxUploadSize\": 5368709120,\n    \"AllowedFormats\": [\"json\", \"csv\", \"parquet\", \"arrow\"],\n    \"TempDirectory\": \"./temp/uploads\"\n  },\n  \n  \"Extensions:Editor\": {\n    \"EnableBatchEditing\": true,\n    \"MaxBatchSize\": 1000,\n    \"AutoSaveInterval\": 30000\n  },\n  \n  \"Extensions:AITools\": {\n    \"HuggingFaceApiKey\": \"\",\n    \"DefaultCaptioningModel\": \"Salesforce/blip-image-captioning-base\",\n    \"DefaultTaggingModel\": \"ViT-L/14\",\n    \"BatchSize\": 10,\n    \"Timeout\": 30000,\n    \"EnableBackgroundProcessing\": true\n  }\n}\n```\n\n## Client Application Configuration (src/ClientApp/wwwroot/appsettings.json)\n\nAdd this to configure the client-side extension system:\n\n```json\n{\n  \"Api\": {\n    \"BaseUrl\": \"https://localhost:5001\"\n  },\n  \n  \"Extensions\": {\n    \"Enabled\": true,\n    \"AutoLoad\": true,\n    \"Directory\": \"./Extensions/BuiltIn\"\n  },\n  \n  \"Extensions:CoreViewer\": {\n    \"DefaultView\": \"grid\",\n    \"ItemsPerPage\": 50,\n    \"EnableInfiniteScroll\": true\n  },\n  \n  \"Extensions:Creator\": {\n    \"ShowWizard\": true,\n    \"DefaultFormat\": \"json\"\n  },\n  \n  \"Extensions:Editor\": {\n    \"EnableRichTextEditor\": true,\n    \"EnableImageEditor\": true\n  },\n  \n  \"Extensions:AITools\": {\n    \"ShowProgressIndicator\": true,\n    \"AutoRefreshResults\": true,\n    \"PollingInterval\": 2000\n  }\n}\n```\n\n## Distributed Deployment Configuration\n\n### Scenario 1: API and Client on Different Servers\n\n**API Server (api.datasetstudio.com) - appsettings.Production.json:**\n```json\n{\n  \"Extensions\": {\n    \"Enabled\": true,\n    \"Directory\": \"/var/www/datasetstudio/extensions\"\n  },\n  \n  \"Cors\": {\n    \"AllowedOrigins\": [\"https://app.datasetstudio.com\"]\n  }\n}\n```\n\n**Client Server (app.datasetstudio.com) - appsettings.Production.json:**\n```json\n{\n  \"Api\": {\n    \"BaseUrl\": \"https://api.datasetstudio.com\"\n  },\n  \n  \"Extensions\": {\n    \"Enabled\": true\n  }\n}\n```\n\n### Scenario 2: Local Development\n\n**API (localhost:5001) - appsettings.Development.json:**\n```json\n{\n  \"Extensions\": {\n    \"Enabled\": true,\n    \"Directory\": \"../Extensions/BuiltIn\"\n  },\n  \n  \"Cors\": {\n    \"AllowedOrigins\": [\"http://localhost:5002\"]\n  }\n}\n```\n\n**Client (localhost:5002) - appsettings.Development.json:**\n```json\n{\n  \"Api\": {\n    \"BaseUrl\": \"http://localhost:5001\"\n  },\n  \n  \"Extensions\": {\n    \"Enabled\": true\n  }\n}\n```\n\n## Environment-Specific Configuration\n\nUse different appsettings files for different environments:\n\n- `appsettings.json` - Base configuration\n- `appsettings.Development.json` - Local development\n- `appsettings.Staging.json` - Staging environment\n- `appsettings.Production.json` - Production environment\n\nThe configuration system automatically merges these files based on the ASPNETCORE_ENVIRONMENT variable.\n\n## Extension-Specific Secrets\n\nFor sensitive configuration (API keys, tokens), use:\n\n1. **Development**: User Secrets\n   ```bash\n   dotnet user-secrets set \"Extensions:AITools:HuggingFaceApiKey\" \"your-key-here\"\n   ```\n\n2. **Production**: Environment Variables\n   ```bash\n   export Extensions__AITools__HuggingFaceApiKey=\"your-key-here\"\n   ```\n\n3. **Cloud**: Azure Key Vault, AWS Secrets Manager, etc.\n\n## Configuration Validation\n\nExtensions can validate their configuration on startup:\n\n```csharp\nprotected override async Task<bool> OnValidateAsync()\n{\n    var apiKey = Context.Configuration[\"HuggingFaceApiKey\"];\n    if (string.IsNullOrEmpty(apiKey))\n    {\n        Logger.LogError(\"HuggingFace API key not configured\");\n        return false;\n    }\n    \n    return true;\n}\n```\nEOF)",
      "Bash(\"c:/Users/kaleb/OneDrive/Desktop/Projects/DatasetEditor/src/Extensions/SDK/PROGRAM_INTEGRATION.md\" <<'EOF'\n# Program.cs Integration Guide\n\nThis guide shows how to integrate the extension system into your Program.cs files for both API and Client projects.\n\n## API Backend Integration (src/APIBackend/Configuration/Program.cs)\n\nAdd extension loading to your API startup:\n\n```csharp\nusing DatasetStudio.APIBackend.Services.Extensions;\n\nWebApplicationBuilder builder = WebApplication.CreateBuilder(args);\n\n// ... existing configuration ...\n\n// TODO: Phase 3 - Extension Loading\n// Add BEFORE builder.Build()\nvar extensionRegistry = new ApiExtensionRegistry(builder.Configuration, builder.Services);\nawait extensionRegistry.DiscoverAndLoadAsync();\n\n// Build the application\nWebApplication app = builder.Build();\n\n// ... existing middleware ...\n\n// TODO: Phase 3 - Extension Configuration\n// Add AFTER app = builder.Build()\nawait extensionRegistry.ConfigureExtensionsAsync(app);\n\n// ... rest of app configuration ...\n\napp.Run();\n```\n\n### Complete Example:\n\n```csharp\nusing DatasetStudio.APIBackend.Endpoints;\nusing DatasetStudio.APIBackend.Extensions;\nusing DatasetStudio.APIBackend.Models;\nusing DatasetStudio.APIBackend.Services.DatasetManagement;\nusing DatasetStudio.APIBackend.Services.Extensions; // Add this\nusing DatasetStudio.DTO.Common;\nusing DatasetStudio.DTO.Datasets;\nusing Microsoft.AspNetCore.Http.Features;\n\nWebApplicationBuilder builder = WebApplication.CreateBuilder(args);\n\n// Configure Kestrel\nbuilder.WebHost.ConfigureKestrel(serverOptions =>\n{\n    serverOptions.Limits.MaxRequestBodySize = 5L * 1024 * 1024 * 1024; // 5GB\n});\n\n// Configure services\nbuilder.Services.Configure<FormOptions>(options =>\n{\n    options.MultipartBodyLengthLimit = 5L * 1024 * 1024 * 1024;\n});\n\nbuilder.Services.AddDatasetServices(builder.Configuration);\nbuilder.Services.AddEndpointsApiExplorer();\nbuilder.Services.AddSwaggerGen();\n\n// Configure CORS\nstring corsPolicyName = \"DatasetEditorClient\";\nstring[] allowedOrigins = builder.Configuration.GetSection(\"Cors:AllowedOrigins\").Get<string[]>() ?? [];\nbuilder.Services.AddCors(options =>\n{\n    options.AddPolicy(corsPolicyName, policy =>\n    {\n        if (allowedOrigins.Length == 0)\n        {\n            policy.AllowAnyOrigin();\n        }\n        else\n        {\n            policy.WithOrigins(allowedOrigins);\n        }\n        policy.AllowAnyHeader().AllowAnyMethod();\n    });\n});\n\n// EXTENSION SYSTEM: Discover and load extensions\nvar extensionRegistry = new ApiExtensionRegistry(builder.Configuration, builder.Services);\nawait extensionRegistry.DiscoverAndLoadAsync();\n\n// Build app\nWebApplication app = builder.Build();\n\n// Development middleware\nif (app.Environment.IsDevelopment())\n{\n    app.UseSwagger();\n    app.UseSwaggerUI();\n}\n\n// Configure middleware pipeline\napp.UseBlazorFrameworkFiles();\napp.UseStaticFiles();\napp.UseRouting();\napp.UseCors(corsPolicyName);\n\n// Map core endpoints\napp.MapDatasetEndpoints();\napp.MapItemEditEndpoints();\n\n// EXTENSION SYSTEM: Configure and initialize extensions\nawait extensionRegistry.ConfigureExtensionsAsync(app);\n\n// Fallback\napp.MapFallbackToFile(\"index.html\");\n\napp.Run();\n```\n\n## Client Application Integration (src/ClientApp/Configuration/Program.cs)\n\nAdd extension loading to your Blazor WASM startup:\n\n```csharp\nusing DatasetStudio.ClientApp.Services.Extensions; // Add this\n\nWebAssemblyHostBuilder builder = WebAssemblyHostBuilder.CreateDefault(args);\n\n// ... existing configuration ...\n\n// TODO: Phase 3 - Extension Loading\n// Add BEFORE await builder.Build().RunAsync()\nvar extensionRegistry = new ClientExtensionRegistry(builder.Configuration, builder.Services);\nawait extensionRegistry.DiscoverAndLoadAsync();\n\nvar host = builder.Build();\n\n// TODO: Phase 3 - Extension Configuration\nawait extensionRegistry.ConfigureExtensionsAsync();\n\nawait host.RunAsync();\n```\n\n### Complete Example:\n\n```csharp\nusing Microsoft.AspNetCore.Components.Web;\nusing Microsoft.AspNetCore.Components.WebAssembly.Hosting;\nusing MudBlazor.Services;\nusing Blazored.LocalStorage;\nusing DatasetStudio.ClientApp;\nusing DatasetStudio.ClientApp.Services.ApiClients;\nusing DatasetStudio.ClientApp.Services.Caching;\nusing DatasetStudio.ClientApp.Services.Extensions; // Add this\nusing DatasetStudio.ClientApp.Services.Interop;\nusing DatasetStudio.ClientApp.Services.StateManagement;\nusing DatasetStudio.ClientApp.Shared.Services;\nusing DatasetStudio.ClientApp.Features.Datasets.Services;\nusing DatasetStudio.Core.BusinessLogic;\nusing DatasetStudio.Core.BusinessLogic.Layouts;\nusing DatasetStudio.Core.BusinessLogic.Parsers;\nusing DatasetStudio.Core.BusinessLogic.Modality;\nusing DatasetStudio.Core.Utilities;\nusing Microsoft.Extensions.Options;\n\nWebAssemblyHostBuilder builder = WebAssemblyHostBuilder.CreateDefault(args);\nbuilder.RootComponents.Add<App>(\"#app\");\nbuilder.RootComponents.Add<HeadOutlet>(\"head::after\");\n\n// HTTP Client\nbuilder.Services.AddScoped(sp => new HttpClient { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });\n\n// Dataset API client\nbuilder.Services.AddOptions<DatasetApiOptions>()\n    .Bind(builder.Configuration.GetSection(\"DatasetApi\"))\n    .Validate(options => !string.IsNullOrWhiteSpace(options.BaseAddress), \"DatasetApi:BaseAddress must be configured.\")\n    .ValidateOnStart();\n\nbuilder.Services.AddHttpClient<DatasetApiClient>((sp, client) =>\n{\n    var options = sp.GetRequiredService<IOptions<DatasetApiOptions>>().Value;\n    client.BaseAddress = new Uri(options.BaseAddress!, UriKind.Absolute);\n});\n\n// MudBlazor and LocalStorage\nbuilder.Services.AddMudServices();\nbuilder.Services.AddBlazoredLocalStorage();\n\n// Core services\nbuilder.Services.AddSingleton<ParserRegistry>();\nbuilder.Services.AddSingleton<ModalityProviderRegistry>();\nbuilder.Services.AddSingleton<LayoutRegistry>();\nbuilder.Services.AddScoped<FormatDetector>();\nbuilder.Services.AddScoped<DatasetCacheService>();\nbuilder.Services.AddScoped<IndexedDbCache>();\nbuilder.Services.AddScoped<FilterService>();\nbuilder.Services.AddScoped<SearchService>();\n\n// Client services\nbuilder.Services.AddScoped<NotificationService>();\nbuilder.Services.AddScoped<NavigationService>();\nbuilder.Services.AddScoped<ItemEditService>();\nbuilder.Services.AddScoped<IndexedDbInterop>();\nbuilder.Services.AddScoped<ImageUrlHelper>();\n\n// State Management\nbuilder.Services.AddScoped<AppState>();\nbuilder.Services.AddScoped<DatasetState>();\nbuilder.Services.AddScoped<FilterState>();\nbuilder.Services.AddScoped<ViewState>();\nbuilder.Services.AddScoped<ApiKeyState>();\n\n// Error handling\nAppDomain.CurrentDomain.UnhandledException += (sender, args) =>\n{\n    Logs.Error($\"Unhandled exception: {args.ExceptionObject}\");\n};\n\nTaskScheduler.UnobservedTaskException += (sender, args) =>\n{\n    Logs.Error($\"Unobserved task exception: {args.Exception}\");\n    args.SetObserved();\n};\n\n// EXTENSION SYSTEM: Discover and load client extensions\nvar extensionRegistry = new ClientExtensionRegistry(builder.Configuration, builder.Services);\nawait extensionRegistry.DiscoverAndLoadAsync();\n\n// Build and run\nvar host = builder.Build();\n\n// EXTENSION SYSTEM: Configure and initialize extensions\nawait extensionRegistry.ConfigureExtensionsAsync();\n\nawait host.RunAsync();\n```\n\n## Error Handling\n\nAdd try-catch blocks around extension loading for production:\n\n```csharp\ntry\n{\n    var extensionRegistry = new ApiExtensionRegistry(builder.Configuration, builder.Services);\n    await extensionRegistry.DiscoverAndLoadAsync();\n    // ... later ...\n    await extensionRegistry.ConfigureExtensionsAsync(app);\n}\ncatch (Exception ex)\n{\n    // Log extension loading errors\n    var logger = app.Services.GetRequiredService<ILogger<Program>>();\n    logger.LogError(ex, \"Failed to load extensions\");\n    \n    // Optionally: continue without extensions or fail fast\n    // throw; // Uncomment to fail fast\n}\n```\n\n## Conditional Extension Loading\n\nLoad extensions only in specific environments:\n\n```csharp\nif (builder.Configuration.GetValue<bool>(\"Extensions:Enabled\", true))\n{\n    var extensionRegistry = new ApiExtensionRegistry(builder.Configuration, builder.Services);\n    await extensionRegistry.DiscoverAndLoadAsync();\n    await extensionRegistry.ConfigureExtensionsAsync(app);\n}\n```\n\n## Accessing Extensions at Runtime\n\nGet loaded extensions from the registry:\n\n```csharp\n// In a controller or service\npublic class DatasetController : ControllerBase\n{\n    private readonly ApiExtensionRegistry _extensionRegistry;\n    \n    public DatasetController(ApiExtensionRegistry registry)\n    {\n        _extensionRegistry = registry;\n    }\n    \n    [HttpGet(\"extensions\")]\n    public IActionResult GetExtensions()\n    {\n        var extensions = _extensionRegistry.GetAllExtensions();\n        return Ok(extensions.Keys);\n    }\n}\n```\n\n## Health Checks\n\nAdd extension health checks:\n\n```csharp\nbuilder.Services.AddHealthChecks()\n    .AddCheck(\"extensions\", () =>\n    {\n        var registry = app.Services.GetRequiredService<ApiExtensionRegistry>();\n        var extensions = registry.GetAllExtensions();\n        \n        foreach (var (id, extension) in extensions)\n        {\n            var health = extension.GetHealthAsync().Result;\n            if (health.Health == ExtensionHealth.Unhealthy)\n            {\n                return HealthCheckResult.Unhealthy($\"Extension {id} is unhealthy\");\n            }\n        }\n        \n        return HealthCheckResult.Healthy();\n    });\n```\nEOF)"
    ],
    "deny": [],
    "ask": []
  }
}
