@* Displays currently active filters as removable chips. *@
<MudStack Direction="Row" Spacing="1" AlignItems="AlignItems.Center" Class="flex-wrap">
    @if (ActiveFilters.Count == 0)
    {
        <MudText Typo="Typo.caption" Class="mud-text-secondary">
            No active filters
        </MudText>
    }
    else
    {
        @foreach (var filter in ActiveFilters)
        {
            <MudChip T="string"
                     Color="Color.Primary"
                     Variant="Variant.Filled"
                     OnClose="@(() => OnRemoveFilterAsync(filter))"
                     Closable="true"
                     Class="mb-1">
                @filter.Label
            </MudChip>
        }
        <MudButton Variant="Variant.Text"
                   Color="Color.Secondary"
                   StartIcon="@Icons.Material.Filled.ClearAll"
                   OnClick="@ClearAllAsync">
            Clear all
        </MudButton>
    }
</MudStack>

@code {
    /// <summary>
    /// Simplified contract describing an active filter. FilterState will project real filter values into this view model.
    /// TODO: Replace with dedicated record struct once FilterState exposes typed representation.
    /// </summary>
    public record FilterChip(string Label, object? Payload);

    /// <summary>
    /// Active filters to render. Parent (FilterPanel/DatasetViewer) should map its state into user-facing labels.
    /// </summary>
    [Parameter] public IReadOnlyList<FilterChip> ActiveFilters { get; set; } = Array.Empty<FilterChip>();

    /// <summary>
    /// Invoked when a single chip is removed. Expected to call FilterService.ClearFilterAsync for the underlying field.
    /// </summary>
    [Parameter] public EventCallback<FilterChip> OnRemoveFilter { get; set; }

    /// <summary>
    /// Invoked when the "Clear all" button is clicked.
    /// </summary>
    [Parameter] public EventCallback OnClearAll { get; set; }

    private async Task OnRemoveFilterAsync(FilterChip chip)
    {
        if (OnRemoveFilter.HasDelegate)
        {
            await OnRemoveFilter.InvokeAsync(chip);
        }
    }

    private async Task ClearAllAsync()
    {
        if (OnClearAll.HasDelegate)
        {
            await OnClearAll.InvokeAsync();
        }
    }
}
