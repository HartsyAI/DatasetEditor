@using MudBlazor

@* Shared confirmation dialog surfaced through MudDialogService. *@
@* TODO: Align styling with future design system (button arrangement, typography). *@
<MudDialog>
    <DialogContent>
        <MudStack Spacing="2">
            <MudText Typo="Typo.h5">@Title</MudText>
            <MudText Typo="Typo.body1" Class="mud-text-secondary">@Message</MudText>
            @if (!string.IsNullOrWhiteSpace(SecondaryMessage))
            {
                <MudText Typo="Typo.caption" Class="mud-text-secondary">@SecondaryMessage</MudText>
            }
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton Color="Color.Secondary"
                   Variant="Variant.Outlined"
                   OnClick="@CancelAsync">
            @_cancelLabel
        </MudButton>
        <MudButton Color="Color.Primary"
                   Variant="Variant.Filled"
                   OnClick="@ConfirmAsync">
            @_confirmLabel
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    /// <summary>
    /// Primary confirmation title. Pass from caller, e.g., NavigationService before destructive actions.
    /// </summary>
    [CascadingParameter] public MudDialogInstance Dialog { get; set; } = default!;

    [Parameter] public string Title { get; set; } = "Confirm action";
    [Parameter] public string Message { get; set; } = "Are you sure you want to continue?";
    [Parameter] public string? SecondaryMessage { get; set; }
        = "This cannot be undone.";

    /// <summary>
    /// TODO: Localize labels once resource pipeline is available.
    /// </summary>
    [Parameter] public string ConfirmLabel { get; set; } = "Confirm";
    [Parameter] public string CancelLabel { get; set; } = "Cancel";

    /// <summary>
    /// Callback invoked when user confirms. Use for dataset deletions, filter resets, etc.
    /// </summary>
    [Parameter] public EventCallback OnConfirm { get; set; }

    /// <summary>
    /// Callback invoked when user cancels. Optional; leave unset for default close behavior.
    /// </summary>
    [Parameter] public EventCallback OnCancel { get; set; }

    private string _confirmLabel => ConfirmLabel;
    private string _cancelLabel => CancelLabel;

    private async Task ConfirmAsync()
    {
        // TODO: Emit telemetry via Logs.Info once analytics strategy defined.
        if (OnConfirm.HasDelegate)
        {
            await OnConfirm.InvokeAsync();
        }

        Dialog.Close(DialogResult.Ok(true));
    }

    private async Task CancelAsync()
    {
        if (OnCancel.HasDelegate)
        {
            await OnCancel.InvokeAsync();
        }

        Dialog.Cancel();
    }
}
