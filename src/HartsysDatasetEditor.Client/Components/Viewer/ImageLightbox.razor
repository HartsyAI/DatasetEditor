@* Full-screen lightbox overlay for high-resolution image preview. *@
<MudDialog>
    <DialogContent>
        <div class="lightbox-container">
            <MudImage Src="@_imageUrl" Alt="Image preview" Elevation="0" ObjectFit="ObjectFit.Contain" Style="max-height: 70vh; width: 100%;" />
            
            @if (Item != null && (!string.IsNullOrEmpty(Item.Title) || Item.Width > 0))
            {
                <div class="lightbox-info">
                    <MudText Typo="Typo.h6">@Item.Title</MudText>
                    @if (Item.Width > 0 && Item.Height > 0)
                    {
                        <MudText Typo="Typo.body2">@Item.GetFormattedDimensions() â€¢ @Item.GetAspectRatioString()</MudText>
                    }
                </div>
            }
        </div>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="@CloseAsync">Close</MudButton>
        <MudButton Color="Color.Primary" OnClick="@DownloadAsync">Download</MudButton>
    </DialogActions>
</MudDialog>

<style>
    .lightbox-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
    }
    
    .lightbox-info {
        width: 100%;
        padding: 16px;
        background: var(--mud-palette-surface);
        border-radius: 4px;
    }
</style>

@code {
    [CascadingParameter] public MudDialogInstance Dialog { get; set; } = default!;

    /// <summary>
    /// Image to display. TODO: Consider passing ImageItem to surface metadata.
    /// </summary>
    [Parameter] public string? ImageUrl { get; set; }

    /// <summary>
    /// TODO: Inject DatasetState to derive currently highlighted image when invoked from ImageGrid.
    /// </summary>
    [Parameter] public ImageItem? Item { get; set; }

    private string _imageUrl => ImageUrl ?? Item?.ImageUrl ?? string.Empty;

    private Task CloseAsync()
    {
        Dialog.Close(DialogResult.Cancel());
        return Task.CompletedTask;
    }

    private Task DownloadAsync()
    {
        // TODO: Integrate with JsInterop/ImageLazyLoadInterop for native download support.
        Logs.Info("ImageLightbox download requested");
        return Task.CompletedTask;
    }
}
